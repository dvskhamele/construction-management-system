'use client'

import React, { useState } from 'react'
import Link from 'next/link'
import { useRouter } from 'next/navigation'
import UserLayout from '../../components/UserLayout'

export default function Pricing() {
  const [isLoggedIn, setIsLoggedIn] = useState(false)
  const [user, setUser] = useState<any>(null)
  const [selectedPlan, setSelectedPlan] = useState('professional')
  const router = useRouter()

  const handleLogout = () => {
    localStorage.removeItem('token')
    setIsLoggedIn(false)
    setUser(null)
    router.push('/login')
  }

  // For prototype, always allow access to authenticated routes
  React.useEffect(() => {
    const token = localStorage.getItem('token') || 'mock-token';
    localStorage.setItem('token', token);
    
    // Mock user data for prototype
    setUser({ name: 'Construction Manager', role: 'ADMIN' } as any);
    setIsLoggedIn(true)
  }, [])

  const pricingPlans = [
    {
      id: 'basic',
      name: 'BuildMate Basic',
      price: '₹999/month',
      priceAnnual: '₹8,888/year',
      originalPrice: '₹2,999/month',
      originalPriceAnnual: '₹35,555/year',
      discount: '67% off',
      description: 'Essential construction management features for small contractors',
      features: [
        'Project tracking with milestone management',
        'Basic crew and equipment tracking',
        'Simple reporting and analytics',
        'Mobile-responsive interface',
        'Email notifications',
        'Up to 5 projects',
        'Basic progress tracking',
        'Customizable as per your needs',
        'Fully end-to-end construction management'
      ],
      cta: 'Start Free Trial',
      popular: false
    },
    {
      id: 'professional',
      name: 'BuildMate Professional',
      price: '₹999/month',
      priceAnnual: '₹8,888/year',
      originalPrice: '₹2,999/month',
      originalPriceAnnual: '₹35,555/year',
      discount: '67% off',
      description: 'Comprehensive solution for growing construction businesses',
      features: [
        'All Basic features',
        'Advanced resource management',
        'Quality control and inspection tools',
        'WhatsApp notifications',
        'Progress analytics dashboard',
        'Up to 20 projects',
        'Priority support',
        'Custom project templates',
        'Customizable as per your needs',
        'Fully end-to-end construction management'
      ],
      cta: 'Start 14-Day Trial',
      popular: true
    },
    {
      id: 'enterprise',
      name: 'BuildMate Enterprise',
      price: '₹999/month',
      priceAnnual: '₹8,888/year',
      originalPrice: '₹2,999/month',
      originalPriceAnnual: '₹35,555/year',
      discount: '67% off',
      description: 'Complete construction management platform',
      features: [
        'All Professional features',
        'Unlimited projects',
        'API access for custom integrations',
        'Advanced reporting & analytics',
        'Custom reporting & analytics',
        'Dedicated account manager',
        'Custom training sessions',
        'White-label options',
        'Unlimited storage for documentation',
        'Customizable as per your needs',
        'Fully end-to-end construction management'
      ],
      cta: 'Contact Sales',
      popular: false
    }
  ]

  const userRoles = [
    { 
      name: 'Project Manager', 
      description: 'Full access to all project management features',
      permissions: ['Create/Edit Projects', 'Manage Teams', 'View Analytics', 'Generate Reports', 'Assign Tasks']
    },
    { 
      name: 'Site Supervisor', 
      description: 'Access to site-specific management tools',
      permissions: ['View Assigned Projects', 'Track Daily Progress', 'Report Issues', 'Update Task Status']
    },
    { 
      name: 'Crew Member', 
      description: 'Limited access for daily task management',
      permissions: ['View Assigned Tasks', 'Update Task Status', 'Report Issues']
    },
    { 
      name: 'Safety Officer', 
      description: 'Access to safety and compliance features',
      permissions: ['Log Safety Incidents', 'Track Compliance', 'Generate Safety Reports', 'Manage Safety Protocols']
    },
    { 
      name: 'Admin', 
      description: 'Full system administration access',
      permissions: ['All Permissions', 'User Management', 'System Configuration', 'Billing Management', 'Audit Logs']
    }
  ]

  if (!isLoggedIn) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center p-4">
        <div className="bg-white p-8 rounded-2xl shadow-xl w-full max-w-sm">
          <h1 className="text-2xl font-bold mb-6 text-center text-slate-800">Construction Management Login</h1>
          <form onSubmit={(e) => {
            e.preventDefault()
            // Mock login for prototype - in a real app, this would call the API
            localStorage.setItem('token', 'mock-jwt-token')
            setUser({ name: 'Construction Manager', role: 'ADMIN' } as any)
            setIsLoggedIn(true)
            // Redirect to pricing after login
            router.push('/pricing')
          }}>
            <div className="mb-4">
              <label htmlFor="email" className="block text-slate-700 mb-2">Email</label>
              <input
                type="email"
                id="email"
                className="w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 transition input text-slate-800 bg-white"
                placeholder="Enter your email"
                defaultValue="admin@buildmate.com"
              />
            </div>
            <div className="mb-6">
              <label htmlFor="password" className="block text-slate-700 mb-2">Password</label>
              <input
                type="password"
                id="password"
                className="w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 transition input text-slate-800 bg-white"
                placeholder="Enter your password"
                defaultValue="password123"
              />
            </div>
            <button
              type="submit"
              className="w-full bg-teal-600 text-white py-3 px-4 rounded-lg hover:bg-teal-700 transition duration-300 shadow-md hover:shadow-lg btn btn-primary"
            >
              Login
            </button>
          </form>
        </div>
      </div>
    )
  }

  return (
    <UserLayout user={user} onLogout={handleLogout}>
      <main className="max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
        {/* Page Header */}
        <div className="mb-8">
          <div className="text-center">
            <h1 className="text-3xl md:text-4xl font-bold text-slate-800 mb-4">Simple, Transparent Pricing</h1>
            <p className="text-xl text-slate-600 max-w-3xl mx-auto">
              Choose the plan that fits your construction business needs and budget. All plans include our core construction management features.
            </p>
          </div>
        </div>

        {/* Pricing Toggle */}
        <div className="flex justify-center mb-8">
          <div className="bg-white rounded-full p-1 shadow-md">
            <div className="flex items-center">
              <span className="px-4 py-2 text-sm font-medium text-slate-700">Monthly</span>
              <span className="px-4 py-2 text-sm font-medium text-slate-700">Annual</span>
              <div className="absolute w-24 h-8 bg-gradient-to-r from-teal-500 to-teal-600 rounded-full transform transition-transform duration-300"></div>
            </div>
          </div>
        </div>

        {/* Pricing Plans */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-5xl mx-auto">
          {pricingPlans.map((plan) => (
            <div 
              key={plan.id} 
              className={`rounded-2xl shadow-lg overflow-hidden ${
                plan.popular 
                  ? 'ring-2 ring-teal-500 transform scale-105 z-10 bg-white' 
                  : 'bg-white'
              }`}
            >
              {plan.popular && (
                <div className="bg-teal-500 text-white text-center py-2">
                  <span className="text-sm font-semibold">MOST POPULAR</span>
                </div>
              )}
              <div className="p-8">
                <h3 className="text-2xl font-bold text-slate-900 mb-2">{plan.name}</h3>
                <div className="mb-4">
                  <div className="flex items-baseline">
                    <span className="text-4xl font-extrabold text-slate-900">{plan.priceAnnual}</span>
                    <span className="text-slate-600 ml-2">/year</span>
                  </div>
                  <div className="text-sm text-slate-500 line-through">{plan.originalPriceAnnual}/year</div>
                  <div className="text-sm text-emerald-600 font-medium mt-1">{plan.discount}</div>
                </div>
                <p className="text-slate-600 mb-6">{plan.description}</p>
                <ul className="space-y-3 mb-8">
                  {plan.features.map((feature, index) => (
                    <li key={index} className="flex items-start">
                      <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-teal-500 mt-0.5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                        <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                      </svg>
                      <span className="ml-2 text-slate-700">{feature}</span>
                    </li>
                  ))}
                </ul>
                <button 
                  onClick={() => {
                    setSelectedPlan(plan.id)
                    if (plan.id === 'basic') {
                      // Handle basic plan
                      alert(`Starting free trial for ${plan.name}`)
                    } else if (plan.id === 'enterprise') {
                      // Handle enterprise plan
                      alert(`Contacting sales for ${plan.name}`)
                    } else {
                      // Handle other plans
                      alert(`Starting 14-day trial for ${plan.name}`)
                    }
                  }}
                  className={`w-full py-3 px-4 rounded-lg font-medium transition duration-300 ${
                    plan.popular
                      ? 'bg-gradient-to-r from-teal-500 to-teal-600 text-white hover:from-teal-600 hover:to-teal-700 shadow-md'
                      : 'bg-slate-100 text-slate-800 hover:bg-slate-200'
                  }`}
                >
                  {plan.cta}
                </button>
              </div>
            </div>
          ))}
        </div>

        {/* User Roles */}
        <div className="mt-16 bg-white rounded-2xl shadow-md p-6 card">
          <div className="text-center mb-8">
            <h2 className="text-3xl font-bold text-slate-800 mb-4">User Roles & Permissions</h2>
            <p className="text-xl text-slate-600 max-w-3xl mx-auto">
              BuildMate supports multiple user roles with customizable permissions to fit your team structure
            </p>
          </div>
          
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
            {userRoles.map((role, index) => (
              <div key={index} className="border border-slate-200 rounded-lg p-6 hover:shadow-md transition duration-300">
                <div className="w-12 h-12 bg-gradient-to-br from-teal-100 to-teal-200 rounded-lg flex items-center justify-center mb-4">
                  <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 text-teal-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                  </svg>
                </div>
                <h3 className="text-lg font-semibold text-slate-800 mb-2">{role.name}</h3>
                <p className="text-sm text-slate-600 mb-4">{role.description}</p>
                <ul className="space-y-2">
                  {role.permissions.map((permission, permIndex) => (
                    <li key={permIndex} className="flex items-start">
                      <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 text-teal-500 mt-0.5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                        <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                      </svg>
                      <span className="ml-2 text-sm text-slate-700">{permission}</span>
                    </li>
                  ))}
                </ul>
              </div>
            ))}
          </div>
        </div>

        {/* Mobile First Approach */}
        <div className="mt-16 bg-white rounded-2xl shadow-md p-6 card">
          <div className="text-center mb-8">
            <h2 className="text-3xl font-bold text-slate-800 mb-4">Mobile First Design</h2>
            <p className="text-xl text-slate-600 max-w-3xl mx-auto">
              Built with a mobile-first approach for optimal performance on all devices
            </p>
          </div>
          
          <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div className="text-center">
              <div className="w-16 h-16 bg-gradient-to-br from-teal-100 to-teal-200 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8 text-teal-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
                </svg>
              </div>
              <h3 className="text-xl font-semibold text-slate-800 mb-2">Touch Optimized</h3>
              <p className="text-slate-600">
                Interface designed specifically for touch interactions with proper sizing and spacing
              </p>
            </div>
            
            <div className="text-center">
              <div className="w-16 h-16 bg-gradient-to-br from-amber-100 to-amber-200 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8 text-amber-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5" />
                </svg>
              </div>
              <h3 className="text-xl font-semibold text-slate-800 mb-2">Responsive Layout</h3>
              <p className="text-slate-600">
                Adapts seamlessly to any screen size with optimized layouts for phones, tablets, and desktops
              </p>
            </div>
            
            <div className="text-center">
              <div className="w-16 h-16 bg-gradient-to-br from-emerald-100 to-emerald-200 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
              </div>
              <h3 className="text-xl font-semibold text-slate-800 mb-2">Fast Performance</h3>
              <p className="text-slate-600">
                Optimized for mobile networks with efficient loading and minimal data usage
              </p>
            </div>
          </div>
          
          <div className="mt-8 bg-gradient-to-r from-teal-500 to-teal-600 rounded-2xl p-8 text-white text-center">
            <h3 className="text-2xl font-bold mb-4">Ready to Transform Your Construction Business?</h3>
            <p className="text-teal-100 mb-6 max-w-2xl mx-auto">
              Join successful construction companies already using BuildMate to streamline operations and improve project delivery. All plans include our core construction management features with the flexibility to customize as per your needs.
            </p>
            <div className="flex flex-col sm:flex-row justify-center gap-4">
              <button 
                className="bg-white text-teal-600 px-8 py-3 rounded-lg font-medium hover:bg-slate-100 transition duration-300 shadow-lg"
                onClick={() => router.push('/demo')}
              >
                View Live Demo
              </button>
              <button 
                className="bg-teal-700 text-white border border-teal-300 px-8 py-3 rounded-lg font-medium hover:bg-teal-800 transition duration-300"
                onClick={() => setSelectedPlan('professional')}
              >
                Start Free Trial
              </button>
            </div>
          </div>
        </div>
      </main>
    </UserLayout>
  )
}